<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Door Timer Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Import Lato ExtraBold and Actor from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Actor&family=Lato:wght@900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/1c2ac3b0da.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="dashboard-card">
        <div class="icon">
            <i class="fa-solid fa-door-closed" id="door-icon"></i>
        </div>
        <div id="door-state" class="door-state {{ 'closed' if door_state == 'closed' else 'open' }}">
            <!-- State text will be set by JS -->
        </div>
        <div class="timer-value" id="timer" style="display:none;">
            <!-- Timer value will be set by JS -->
        </div>
    </div>

    <h2>Bathroom Session Log</h2>
<table>
  <tr><th>Start</th><th>End</th><th>Duration (s)</th></tr>
  {% for session in session_log %}
    <tr>
      <td>{{ session.start }}</td>
      <td>{{ session.end }}</td>
      <td>{{ session.duration }}</td>
    </tr>
  {% endfor %}
</table>
    <div class="footer">
        &copy; {{ 2025 }} Mama Condit
    </div>
    <script>
      function poll() {
        fetch('/status').then(r => r.json()).then(data => {
          let stateDiv = document.getElementById('door-state');
          let timerDiv = document.getElementById('timer');
          let icon = document.getElementById('door-icon');

          if (data.door_state === "closed") {
            // Show "In use" in red and show timer
            stateDiv.textContent = "Downstairs bathroom in use";
            stateDiv.className = "door-state closed";
            timerDiv.textContent = data.timer + ' seconds';
            timerDiv.style.display = "block";
            icon.className = "fa-solid fa-door-closed icon";
            icon.style.color = "#dc3545"; // Red for closed
          } else {
            // Show "Open" in green and hide timer
            stateDiv.textContent = "Downstairs bathroom open";
            stateDiv.className = "door-state open";
            timerDiv.style.display = "none";
            icon.className = "fa-solid fa-door-open icon";
            icon.style.color = "#9f9a2b"; // Leaf green for open
          }
        });
      }
      // Call poll immediately and then every second
      poll();
      setInterval(poll, 1000);
    </script>
</body>
</html>
